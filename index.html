<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css" integrity="sha512-10/jx2EXwxxWqCLX/hHth/vu2KY3jCF70dCQB8TSgNjbCVAC/8vai53GfMDrO2Emgwccf2pJqxct9ehpzG+MTw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.7.4/js/foundation.min.js" integrity="sha512-+CnEgueYRDzx2s3IIAOpZd8HeOfrSbK3loeHw0jXJODAe3eFROHpBxEsun2kU+sZCaoAA0eFJrhfVV3RGG50GA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }
    </style>
  </head>
  <body>
    <h2 class="text-center" style="margin: 1rem auto ;">Barcode / QR code reader using Barcode Detection API </h2>
  <div class="grid-x  grid-padding-x align-center" style="justify-content: center;">
    <div id="videoDiv">
      <video id="video" width="500" style="margin: 4rem auto;"></video>
    </div>

    <div class="grid-container">
      <h4> Raw data retrieved from barcode/ QRcode</h4>
      <ul id="barcode-list"></ul>
    </div>


  </div>
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script>
    $(document).foundation();
    /* Details https://developer.mozilla.org/en-US/docs/Web/API/Barcode_Detection_API */
    document.addEventListener("DOMContentLoaded", () => {
      alert("This feature is available only in secure contexts (HTTPS)");
      detect();
    });

    async function detect() {
      const barcodeDetector = new BarcodeDetector();
      const list = document.getElementById("barcode-list");
      const videoDiv = document.getElementById("videoDiv");
      let itemsFound = [];
      const mediaStream = await navigator.mediaDevices.getUserMedia({
        video: {
          facingMode: "environment"
        },
      });

      /*   const video = document.createElement("video"); */
      const video = document.getElementById("video");
      video.srcObject = mediaStream;
      video.autoplay = true;

      // list.before(video);
      videoDiv.before(video);

      function render() {
        barcodeDetector
          .detect(video)
          .then((barcodes) => {
            barcodes.forEach((barcode) => {
              if (!itemsFound.includes(barcode.rawValue)) {
                itemsFound.push(barcode.rawValue);
                const li = document.createElement("li");
                li.innerHTML = barcode.rawValue;
                list.appendChild(li);
              }
            });
          })
          .catch(console.error);
      }

      (function renderLoop() {
        requestAnimationFrame(renderLoop);
        render();
      })();
    }
  </script>
  </body>
</html>
