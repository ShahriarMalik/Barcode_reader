<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }
    </style>
  </head>
  <body>
    <ul id="barcode-list"></ul>
    <script>
       document.addEventListener("DOMContentLoaded", () => {
      alert("This feature is available only in secure contexts (HTTPS)");
      detect();
    });

      async function detect() {
        const barcodeDetector = new BarcodeDetector();
        const list = document.getElementById("barcode-list");
        let itemsFound = [];
        const mediaStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: "environment" },
        });

        const video = document.createElement("video");
        video.srcObject = mediaStream;
        video.autoplay = true;

        list.before(video);

        function render() {
          barcodeDetector
            .detect(video)
            .then((barcodes) => {
              barcodes.forEach((barcode) => {
                if (!itemsFound.includes(barcode.rawValue)) {
                  itemsFound.push(barcode.rawValue);
                  const li = document.createElement("li");
                  li.innerHTML = barcode.rawValue;
                  list.appendChild(li);
                }
              });
            })
            .catch(console.error);
        }

        (function renderLoop() {
          requestAnimationFrame(renderLoop);
          render();
        })();
      }
    </script>
  </body>
</html>
